{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-8">

    <!-- Page Heading -->
    <h1 class="text-3xl font-bold text-gray-800 mb-8">Available Exams</h1>

    {% if exams_info %}
    <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">

        {% for info in exams_info %}
        {% with exam=info.exam %}
        <div class="bg-white border border-gray-200 rounded-2xl shadow-md hover:shadow-xl transition transform hover:-translate-y-1 p-6 flex flex-col justify-between">

            <!-- Header with Icon -->
            <div class="flex items-center mb-4">
                <div class="flex-shrink-0 bg-blue-100 text-blue-700 rounded-full p-3 mr-4">
                    <!-- Book Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
                         viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M12 20h9M12 4H3m0 0v16a2 2 0 002 2h7V4z"/>
                    </svg>
                </div>
                <h2 class="text-xl font-semibold text-gray-900">{{ exam.title }}</h2>
            </div>

            <!-- Exam Info -->
            <p class="text-sm text-gray-500 mb-2">Course: {{ exam.course.title }}</p>
            <p class="text-sm text-gray-500 mb-4">
                Duration: <span class="font-medium">{{ exam.duration }} min</span>
            </p>

            <!-- Progress / Attempts Bar -->
            <div class="mb-4">
                <div class="flex justify-between text-xs mb-1">
                    <span>Attempts: {{ info.attempts_done }}</span>
                    <span>Remaining: {{ info.attempts_remaining }}</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    {% if info.attempts_remaining == 'Unlimited' %}
                        <div class="bg-blue-600 h-2 rounded-full w-full"></div>
                    {% else %}
                        {% with total=info.attempts_done|add:info.attempts_remaining %}
                        {% if total > 0 %}
                        <div class="bg-blue-600 h-2 rounded-full"
                             style="width: {{ info.attempts_done|divisibleby:total|floatformat:2 }}%;">
                        </div>
                        {% else %}
                        <div class="bg-blue-600 h-2 rounded-full w-0"></div>
                        {% endif %}
                        {% endwith %}
                    {% endif %}
                </div>
            </div>

            <!-- Status Badges -->
            <div class="flex flex-wrap gap-2 text-xs mb-4">
                {% if not info.can_start %}
                <span class="px-3 py-1 rounded-full bg-red-100 text-red-700">No Attempts Left</span>
                {% endif %}
                {% if info.attempts_remaining != 'Unlimited' and info.attempts_remaining > 0 %}
                <span class="px-3 py-1 rounded-full bg-green-100 text-green-700">Can Start</span>
                {% endif %}
            </div>

            <!-- Action Button -->
            {% if info.can_start %}
            <a href="{% url 'start_exam' exam.id %}"
               class="mt-auto inline-block w-full text-center bg-blue-600 text-white py-2 rounded-xl font-medium hover:bg-blue-700 transition">
                Start Exam
            </a>
            {% else %}
            <button disabled
                class="mt-auto w-full bg-gray-300 text-gray-600 py-2 rounded-xl font-medium cursor-not-allowed">
                No Attempts Left
            </button>
            {% endif %}

        </div>
        {% endwith %}
        {% endfor %}

    </div>
    {% else %}
    <p class="text-gray-500 text-center mt-8 text-lg">No exams available at the moment.</p>
    {% endif %}

</div>
{% endblock %}